# 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ BGP –Ω–∞ rtr-cod

[‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](../README.md) | [‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–æ–¥—É–ª—å](02-fw-cod-config.md)

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–í–∞—Ä–∏–∞–Ω—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–≤–∞—Ä–∏–∞–Ω—Ç-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- [–ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ BGP](#–±–∞–∑–æ–≤–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-bgp)
- [–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–Ω–∞—Å—Ç—Ä–æ–µ–∫)

---

## –í–∞—Ä–∏–∞–Ω—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### rtr-cod (EcoRouter)

–ü–æ —É—Å–ª–æ–≤–∏—è–º –∑–∞–¥–∞–Ω–∏—è:
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –¶–û–î –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **–ø–æ BGP**
- –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **–ó–ê–ü–†–ï–©–ï–ù–û!**
- –°–æ—Å–µ–¥—Å—Ç–≤–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ IPv4 —Å –∞–¥—Ä–µ—Å–∞ —à–ª—é–∑–∞ –Ω–∞ –≤—ã–¥–µ–ª—è–µ–º—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º –∞–¥—Ä–µ—Å

---

## –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ BGP

### –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ BGP

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª BGP, —É–∫–∞–∑–∞–≤ –Ω–æ–º–µ—Ä –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã:

```
rtr-cod(config)#router bgp 64500
rtr-cod(config-router)#
```

> üìù **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ù–æ–º–µ—Ä AS `64500` ‚Äî —ç—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è rtr-cod.

---

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Router ID

–£–∫–∞–∂–∏—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ BGP:

```
rtr-cod(config-router)#bgp router-id 178.207.179.4
rtr-cod(config-router)#
```

> üí° –í –∫–∞—á–µ—Å—Ç–≤–µ Router ID –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è IP-–∞–¥—Ä–µ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ ‚Äî –∞–¥—Ä–µ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ISP).

---

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ BGP-—Å–æ—Å–µ–¥—Å—Ç–≤–∞

–°–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π—Ç–µ BGP-—Å–æ—Å–µ–¥—Å—Ç–≤–æ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º ISP, —É–∫–∞–∑–∞–≤ –∞–¥—Ä–µ—Å —Å–æ—Å–µ–¥–∞ –∏ –Ω–æ–º–µ—Ä –µ–≥–æ AS:

```
rtr-cod(config-router)#neighbor 178.207.179.1 remote-as 31133
rtr-cod(config-router)#exit
rtr-cod(config)#write memory
Building configuration...

rtr-cod(config)#
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| Neighbor IP | 178.207.179.1 | IP-–∞–¥—Ä–µ—Å —à–ª—é–∑–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (GIGAFON COD) |
| Remote AS | 31133 | –ù–æ–º–µ—Ä –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ |

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ BGP-—Å–æ—Å–µ–¥—Å—Ç–≤–∞

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π BGP –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π `show ip bgp summary`:

![BGP Summary](../images/rtr-cod_bgp_summary.png)

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| BGP router identifier | 178.207.179.4 | –ù–∞—à Router ID |
| Local AS number | 64500 | –ù–æ–º–µ—Ä –Ω–∞—à–µ–π AS |
| Neighbor | 178.207.179.1 | IP —Å–æ—Å–µ–¥–∞ (ISP) |
| AS | 31133 | AS —Å–æ—Å–µ–¥–∞ |
| State/PfxRcd | 1 | –ü–æ–ª—É—á–µ–Ω 1 –ø—Ä–µ—Ñ–∏–∫—Å (–º–∞—Ä—à—Ä—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |
| Established sessions | 1 | –°–µ—Å—Å–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ |

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π `show ip route`:

![BGP Route](../images/rtr-cod_bgp_route.png)

–í —Ç–∞–±–ª–∏—Ü–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ—è–≤–∏–ª—Å—è –º–∞—Ä—à—Ä—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø–æ BGP:

```
B*      0.0.0.0/0 [20/0] via 178.207.179.1, isp, 00:00:16
```

**–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞:**
- `B` ‚Äî –º–∞—Ä—à—Ä—É—Ç –ø–æ–ª—É—á–µ–Ω –ø–æ BGP
- `*` ‚Äî –º–∞—Ä—à—Ä—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (candidate default)
- `[20/0]` ‚Äî –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è BGP / –º–µ—Ç—Ä–∏–∫–∞
- `via 178.207.179.1` ‚Äî next-hop (—à–ª—é–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)
- `isp` ‚Äî –≤—ã—Ö–æ–¥–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑–Ω–æ—Å—Ç—å —Å –≤–Ω–µ—à–Ω–∏–º —Ä–µ—Å—É—Ä—Å–æ–º:

![Ping Internet](../images/rtr-cod_bgp_ping.png)

```
rtr-cod#ping 77.88.8.8
PING 77.88.8.8 (77.88.8.8) 56(84) bytes of data.
64 bytes from 77.88.8.8: icmp_seq=1 ttl=51 time=187 ms
...
4 packets transmitted, 4 received, 0% packet loss
```

‚úÖ –î–æ—Å—Ç—É–ø –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —á–µ—Ä–µ–∑ BGP —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

---

## –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è BGP

```
router bgp 64500
 bgp router-id 178.207.179.4
 neighbor 178.207.179.1 remote-as 31133
```

---

[‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](../README.md) | [‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–æ–¥—É–ª—å](02-fw-cod-config.md) | [–°–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å ‚Üí](04-tunnel-config.md)
