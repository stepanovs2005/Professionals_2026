# 10. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–º—É—Ç–∞—Ü–∏–∏ –º–µ–∂–¥—É sw1-cod –∏ sw2-cod

[‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](../README.md) | [‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–æ–¥—É–ª—å](09-fwcod-vlan-config.md) | [–°–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å ‚Üí](11-next-config.md)

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [sw1-cod ‚Äî –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#sw1-cod--–±–∞–∑–æ–≤–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
  - [–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞](#–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ-–∏–º–µ–Ω–∏-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
- [fw-cod ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏](#fw-cod--–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
  - [–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#—Å–æ–∑–¥–∞–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  - [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ –ø–æ–¥—Å–µ—Ç—è–º](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏-–ø–æ-–ø–æ–¥—Å–µ—Ç—è–º)
- [sw1-cod ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–º—É—Ç–∞—Ü–∏–∏](#sw1-cod--–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∫–æ–º–º—É—Ç–∞—Ü–∏–∏)
  - [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)
  - [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Open vSwitch](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-open-vswitch)
- [sw2-cod ‚Äî –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#sw2-cod--–±–∞–∑–æ–≤–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [sw1-cod ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Open vSwitch](#sw1-cod--–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-open-vswitch)
  - [–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-–∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–∞)
  - [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ access-–ø–æ—Ä—Ç–æ–≤](#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-access-–ø–æ—Ä—Ç–æ–≤)
  - [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ trunk-–ø–æ—Ä—Ç–∞](#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-trunk-–ø–æ—Ä—Ç–∞)
  - [–°–æ–∑–¥–∞–Ω–∏–µ bond-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-bond-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
  - [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ management-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-management-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)

---

## –û–±–∑–æ—Ä

–í –¥–∞–Ω–Ω–æ–º –º–æ–¥—É–ª–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∫–æ–º–º—É—Ç–∞—Ü–∏—è –≤ –æ—Ñ–∏—Å–µ COD —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Open vSwitch** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö –ê–ª—å—Ç –°–µ—Ä–≤–µ—Ä 11, –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö —Ä–æ–ª—å –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–æ–≤.

### –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è sw1-cod

| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | VLAN | –¢–∏–ø –ø–æ—Ä—Ç–∞ |
|-----------|-------------|------|-----------|
| ens19 | fw-cod | 100,200,300,400,500 | trunk |
| ens21 | sw2-cod (bond) | 100,200,300,400,500 | trunk |
| ens22 | sw2-cod (bond) | 100,200,300,400,500 | trunk |
| enp2s1 | srv1-cod | 100 | access |
| enp2s29 | admin-cod | 300 | access |
| enp3s12 | srv2-cod | 200 | access |

> ‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò–º–µ–Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –°–≤–µ—Ä–∫—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ –ø–æ MAC-–∞–¥—Ä–µ—Å–∞–º.

---

## sw1-cod ‚Äî –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–î–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–æ–ø–æ–ª–æ–≥–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
hostnamectl set-hostname sw1-cod.cod.ssa2026.region; exec bash
```

–¢–∞–∫–∂–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç—å –∏–º—è –≤ —Ñ–∞–π–ª–µ `/etc/sysconfig/network`:

```bash
nano /etc/sysconfig/network
```

–£–∫–∞–∂–∏—Ç–µ –∏–º—è –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `HOSTNAME`:

![Hostname config](../images/sw1-cod_hostname_config.png)

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–º–∞–Ω–¥–æ–π:

```bash
hostname -f
```

![Hostname check](../images/sw1-cod_hostname_check.png)

‚úÖ –ò–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ `sw1-cod.cod.ssa2026.region` —É—Å–ø–µ—à–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ.

---

## fw-cod ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

> üìù **–í–∞–∂–Ω–æ:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Äî –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ —É—Å–ª–æ–≤–∏–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —á–µ—Ä–µ–∑ NGFW Novum. –î–ª—è —Ä–∞–±–æ—Ç—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É **https://172.16.1.2:8443**.

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí –£—á—ë—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏** –∏ –Ω–∞–∂–º–∏—Ç–µ **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:

![Users menu](../images/fw-cod_users_menu.png)

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

![Add user form](../images/fw-cod_add_user_form.png)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | network |
| –õ–æ–≥–∏–Ω | network |
| –ü–∞—Ä–æ–ª—å | (–æ—Å—Ç–∞–≤–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) |

> üìù **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–∞—Ä–æ–ª—å –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º ‚Äî –æ–Ω –Ω–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ –ø–æ–¥—Å–µ—Ç—è–º.

–ù–∞–∂–º–∏—Ç–µ **–î–æ–±–∞–≤–∏—Ç—å**.

–†–µ–∑—É–ª—å—Ç–∞—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

![User result](../images/fw-cod_user_result.png)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ –ø–æ–¥—Å–µ—Ç—è–º

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Üí –ü–û –ü–û–î–°–ï–¢–Ø–ú** –∏ –Ω–∞–∂–º–∏—Ç–µ **+ –î–æ–±–∞–≤–∏—Ç—å**:

![Auth subnet menu](../images/fw-cod_auth_subnet_menu.png)

–í —Ñ–æ—Ä–º–µ **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** —É–∫–∞–∂–∏—Ç–µ:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | network |
| –ü–æ–¥—Å–µ—Ç—å | 192.168.0.0/16 |

> üìù **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í —Å–µ—Ç—å `192.168.0.0/16` –≤—Ö–æ–¥—è—Ç –≤—Å–µ –ø–æ–¥—Å–µ—Ç–∏ –æ—Ñ–∏—Å–∞ COD:
> - 192.168.10.0/24 (SRV-COD)
> - 192.168.20.0/24 (DATA)
> - 192.168.30.0/24 (MGMT-COD)
> - 192.168.40.0/24 (CLI)
> - 192.168.50.0/24 (VOIP)

–ù–∞–∂–º–∏—Ç–µ **–î–æ–±–∞–≤–∏—Ç—å**.

‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –ø–æ–¥—Å–µ—Ç—è–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞.

---

## sw1-cod ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–º—É—Ç–∞—Ü–∏–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Å–≤–µ—Ä–∫–∞ –ø–æ MAC-–∞–¥—Ä–µ—Å–∞–º):

```bash
ip -c -br a
```

![Interfaces down](../images/sw1-cod_ifaces_down.png)

–í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ:
- `ens19` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É fw-cod
- `ens21` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É sw2-cod
- `ens22` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É sw2-cod
- `enp2s1` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É srv1-cod
- `enp2s29` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É admin-cod
- `enp3s12` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É srv2-cod

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:

```bash
ls /etc/net/ifaces/
```

![Interfaces list](../images/sw1-cod_ifaces_list.png)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ —Ñ–∞–π–ª `options`:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p /etc/net/ifaces/{ens19,ens21,ens22,enp2s1,enp2s29,enp3s12}

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ options –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
for iface in ens19 ens21 ens22 enp2s1 enp2s29 enp3s12; do
    cat > /etc/net/ifaces/$iface/options << EOF
TYPE=eth
BOOTPROTO=static
EOF
done
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–ª—É–∂–±—É network:

```bash
systemctl restart network
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–µ—Ä–µ—à–ª–∏ –≤ —Å—Ç–∞—Ç—É—Å UP:

```bash
ip -c -br a
```

![Interfaces up](../images/sw1-cod_ifaces_up.png)

‚úÖ –í—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ —Å—Ç–∞—Ç—É—Å–µ UP.

---

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Open vSwitch

–í—Ä–µ–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–¥–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å VLAN 300 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç:

```bash
ip link add link ens19 name ens19.300 type vlan id 300
ip link set dev ens19.300 up
ip addr add 192.168.30.1/24 dev ens19.300
ip route add 0.0.0.0/0 via 192.168.30.254
echo "nameserver 77.88.8.8" > /etc/resolv.conf
```

–û–±–Ω–æ–≤–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Open vSwitch:

```bash
apt-get update && apt-get install -y openvswitch
```

–í–∫–ª—é—á–∏—Ç–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É:

```bash
systemctl enable --now openvswitch
```

–û—Ç–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ OVS –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ:

```bash
sed -i "s/OVS_REMOVE=yes/OVS_REMOVE=no/g" /etc/net/ifaces/default/options
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:

```bash
reboot
```

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ sw2-cod –∫ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É:

```bash
ovs-vsctl add-br br0
ovs-vsctl add-port br0 ens19
ovs-vsctl add-port br0 ens21
```

---

## sw2-cod ‚Äî –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ sw1-cod:

```bash
hostnamectl set-hostname sw2-cod.cod.ssa2026.region; exec bash
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```bash
hostname -f
```

![sw2-cod hostname](../images/sw2-cod_hostname_check.png)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Open vSwitch

–°–æ–∑–¥–∞–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç:

```bash
ip link add link ens19 name ens19.300 type vlan id 300
ip link set up ens19
ip link set up ens19.300
ip addr add 192.168.30.2/24 dev ens19.300
ip route add 0.0.0.0/0 via 192.168.30.254
echo "nameserver 77.88.8.8" > /etc/resolv.conf
```

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Open vSwitch:

```bash
apt-get update && apt-get install -y openvswitch
systemctl enable --now openvswitch
sed -i "s/OVS_REMOVE=yes/OVS_REMOVE=no/g" /etc/net/ifaces/default/options
reboot
```

---

## sw1-cod ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Open vSwitch

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–∞

–£–¥–∞–ª–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä –∏ —Å–æ–∑–¥–∞–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π:

```bash
ovs-vsctl del-br br0
ovs-vsctl add-br sw1-cod
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–∞:

```bash
ovs-vsctl show
```

![OVS bridge](../images/sw1-cod_ovs_bridge.png)

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ access-–ø–æ—Ä—Ç–æ–≤

–î–æ–±–∞–≤—å—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∫–∞–∫ access-–ø–æ—Ä—Ç—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º VLAN:

```bash
# admin-cod (VLAN 300)
ovs-vsctl add-port sw1-cod enp2s29 tag=300

# srv1-cod (VLAN 100)
ovs-vsctl add-port sw1-cod enp2s1 tag=100

# srv2-cod (VLAN 200)
ovs-vsctl add-port sw1-cod enp3s12 tag=200
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ trunk-–ø–æ—Ä—Ç–∞

–î–æ–±–∞–≤—å—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É fw-cod –∫–∞–∫ trunk-–ø–æ—Ä—Ç:

```bash
ovs-vsctl add-port sw1-cod ens19 trunk=100,200,300,400,500
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤:

```bash
ovs-vsctl show
```

![OVS ports](../images/sw1-cod_ovs_ports.png)

### –°–æ–∑–¥–∞–Ω–∏–µ bond-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

–í–∫–ª—é—á–∏—Ç–µ –º–æ–¥—É–ª—å —è–¥—Ä–∞ –¥–ª—è —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ (802.1Q):

```bash
modprobe 8021q
echo "8021q" | tee -a /etc/modules
```

–°–æ–∑–¥–∞–π—Ç–µ bond-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Ä–µ–∂–∏–º–µ active-backup:

```bash
ovs-vsctl add-bond sw1-cod bond0 ens21 ens22 bond_mode=active-backup
```

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ bond –∫–∞–∫ trunk-–ø–æ—Ä—Ç:

```bash
ovs-vsctl set port bond0 trunk=100,200,300,400,500
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
ovs-vsctl show
```

![OVS bond](../images/sw1-cod_ovs_bond.png)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ management-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

–°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è management-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

```bash
mkdir /etc/net/ifaces/mgmt-cod
```

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `options`:

```bash
vim /etc/net/ifaces/mgmt-cod/options
```

![mgmt options](../images/sw1-cod_mgmt_options.png)

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:

```
TYPE=ovsport
BOOTPROTO=static
CONFIG_IPV4=yes
BRIDGE=sw1-cod
VID=300
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| TYPE | –¢–∏–ø –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (ovsport) |
| BOOTPROTO | –°–ø–æ—Å–æ–± –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å–µ—Ç–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ |
| CONFIG_IPV4 | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é IPv4 |
| BRIDGE | –ú–æ—Å—Ç, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å |
| VID | –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ VLAN |

–ù–∞–∑–Ω–∞—á—å—Ç–µ IP-–∞–¥—Ä–µ—Å –∏ —à–ª—é–∑:

```bash
echo "192.168.30.1/24" > /etc/net/ifaces/mgmt-cod/ipv4address
echo "default via 192.168.30.254" > /etc/net/ifaces/mgmt-cod/ipv4route
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–ª—É–∂–±—É network:

```bash
systemctl restart network
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π IP-–∞–¥—Ä–µ—Å:

```bash
ip -c -br -4 a
```

![mgmt IP](../images/sw1-cod_mgmt_ip.png)

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```bash
ip -c r
```

![mgmt route](../images/sw1-cod_mgmt_route.png)

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ–±–∞–≤–∏–ª—Å—è –≤ –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä:

```bash
ovs-vsctl show
```

![OVS mgmt](../images/sw1-cod_ovs_mgmt.png)

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ NativeVLAN –¥–ª—è management-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

```bash
ovs-vsctl set port mgmt-cod vlan_mode=native-untagged
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É:

```bash
ovs-vsctl list port mgmt-cod
```

![mgmt native](../images/sw1-cod_mgmt_native.png)

‚úÖ –ö–æ–º–º—É—Ç–∞—Ü–∏—è –Ω–∞ sw1-cod —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!

---

## –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### sw1-cod ‚Äî Open vSwitch

| –ü–æ—Ä—Ç | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å | –¢–∏–ø | VLAN/Trunk |
|------|-----------|-----|------------|
| enp2s29 | admin-cod | access | 300 |
| enp2s1 | srv1-cod | access | 100 |
| enp3s12 | srv2-cod | access | 200 |
| ens19 | fw-cod | trunk | 100,200,300,400,500 |
| bond0 | sw2-cod | trunk | 100,200,300,400,500 |
| mgmt-cod | management | internal | 300 (native-untagged) |

### sw1-cod ‚Äî –°–µ—Ç–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| Hostname | sw1-cod.cod.ssa2026.region |
| Management IP | 192.168.30.1/24 |
| Gateway | 192.168.30.254 |
| VLAN | 300 (MGMT-COD) |

### sw2-cod ‚Äî –°–µ—Ç–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| Hostname | sw2-cod.cod.ssa2026.region |
| Management IP | 192.168.30.2/24 |
| Gateway | 192.168.30.254 |
| VLAN | 300 (MGMT-COD) |

---

[‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](../README.md) | [‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–æ–¥—É–ª—å](09-fwcod-vlan-config.md) | [–°–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å ‚Üí](11-next-config.md)
