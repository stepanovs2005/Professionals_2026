# –ú–æ–¥—É–ª—å 20. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (LVM)

[‚Üê –ù–∞–∑–∞–¥ –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](../README.md)

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

* [–û–ø–∏—Å–∞–Ω–∏–µ](#–æ–ø–∏—Å–∞–Ω–∏–µ)
* [–ß–∞—Å—Ç—å 1: –°–æ–∑–¥–∞–Ω–∏–µ LVM](#—á–∞—Å—Ç—å-1-—Å–æ–∑–¥–∞–Ω–∏–µ-lvm)
* [–ß–∞—Å—Ç—å 2: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—á–∞—Å—Ç—å-2-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
* [–ü—Ä–æ–≤–µ—Ä–∫–∞](#–ø—Ä–æ–≤–µ—Ä–∫–∞)

---

## –û–ø–∏—Å–∞–Ω–∏–µ

–í –¥–∞–Ω–Ω–æ–º –º–æ–¥—É–ª–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è LVM-—Ç–æ–º –Ω–∞ –¥–∏—Å–∫–µ, –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω–æ–º –ø–æ iSCSI (–∏–∑ –º–æ–¥—É–ª—è 19), –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- |
| –°–µ—Ä–≤–µ—Ä | srv1-cod |
| –î–∏—Å–∫ | /dev/sdb (iSCSI, 5 –ì–ë) |
| Volume Group | VG |
| Logical Volume | DATA |
| –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ | XFS |
| –¢–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è | /opt/data |

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ LVM:**
```
/dev/sdb (5 –ì–ë, iSCSI)
    ‚îî‚îÄ‚îÄ PV (Physical Volume)
        ‚îî‚îÄ‚îÄ VG (Volume Group)
            ‚îî‚îÄ‚îÄ DATA (Logical Volume, 100%)
                ‚îî‚îÄ‚îÄ /opt/data (XFS)
```

---

## –ß–∞—Å—Ç—å 1: –°–æ–∑–¥–∞–Ω–∏–µ LVM

### srv1-cod (alt-server)

#### –®–∞–≥ 1.1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∏—Å–∫–∞

–ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –±–ª–æ—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:

```bash
lsblk
```

![–°–ø–∏—Å–æ–∫ –±–ª–æ—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤](../images/lvm-lsblk.png)

> ‚ÑπÔ∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–∏—Å–∫ `sdb` (5 –ì–ë) ‚Äî —ç—Ç–æ iSCSI-–¥–∏—Å–∫, –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–π —Å srv2-cod –≤ –º–æ–¥—É–ª–µ 19.

#### –®–∞–≥ 1.2: –°–æ–∑–¥–∞–Ω–∏–µ Physical Volume (PV)

–ü–æ–º–µ—Ç—å—Ç–µ –¥–∏—Å–∫ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ LVM:

```bash
pvcreate /dev/sdb
```

![–°–æ–∑–¥–∞–Ω–∏–µ Physical Volume](../images/lvm-pvcreate.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `Physical volume "/dev/sdb" successfully created.`

#### –®–∞–≥ 1.3: –°–æ–∑–¥–∞–Ω–∏–µ Volume Group (VG)

–°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ç–æ–º–æ–≤ —Å –∏–º–µ–Ω–µ–º `VG`:

```bash
vgcreate VG /dev/sdb
```

![–°–æ–∑–¥–∞–Ω–∏–µ Volume Group](../images/lvm-vgcreate.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `Volume group "VG" successfully created`

#### –®–∞–≥ 1.4: –°–æ–∑–¥–∞–Ω–∏–µ Logical Volume (LV)

–°–æ–∑–¥–∞–π—Ç–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–æ–º `DATA`, –∏—Å–ø–æ–ª—å–∑—É—è 100% —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞:

```bash
lvcreate -l 100%FREE -n DATA VG
```

![–°–æ–∑–¥–∞–Ω–∏–µ Logical Volume](../images/lvm-lvcreate.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `Logical volume "DATA" created.`

#### –®–∞–≥ 1.5: –ü—Ä–æ–≤–µ—Ä–∫–∞ LVM

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–æ–º:

```bash
lvdisplay
```

![–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Logical Volume](../images/lvm-lvdisplay.png)

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- |
| LV Path | /dev/VG/DATA |
| LV Name | DATA |
| VG Name | VG |
| LV Size | <5.00 GiB |

---

## –ß–∞—Å—Ç—å 2: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### srv1-cod (alt-server)

#### –®–∞–≥ 2.1: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ XFS

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É XFS –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–æ–º —Ç–æ–º–µ:

```bash
mkfs.xfs /dev/VG/DATA
```

![–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ XFS](../images/lvm-mkfs-xfs.png)

#### –®–∞–≥ 2.2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
mkdir /opt/data
```

#### –®–∞–≥ 2.3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `/etc/fstab`:

```bash
nano /etc/fstab
```

–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:

```
/dev/VG/DATA    /opt/data    xfs    defaults,_netdev    0 0
```

![–ù–∞—Å—Ç—Ä–æ–π–∫–∞ fstab](../images/lvm-fstab.png)

**–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- | --- |
| –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ | /dev/VG/DATA | –ü—É—Ç—å –∫ LV |
| –¢–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è | /opt/data | –ö—É–¥–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å |
| –¢–∏–ø –§–° | xfs | –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ |
| –û–ø—Ü–∏–∏ | defaults,_netdev | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ + —Å–µ—Ç–µ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ |
| dump | 0 | –ù–µ –¥–µ–ª–∞—Ç—å backup |
| pass | 0 | –ù–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å fsck |

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –û–ø—Ü–∏—è `_netdev` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è iSCSI-–¥–∏—Å–∫–æ–≤! –û–Ω–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–µ –¥–æ–∂–¥–∞—Ç—å—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ç–∏ –ø–µ—Ä–µ–¥ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–ø–æ UUID):**
```bash
# –ü–æ–ª—É—á–∏—Ç—å UUID
blkid /dev/VG/DATA

# –ó–∞–ø–∏—Å—å –≤ fstab
UUID=<–≤–∞—à-uuid>    /opt/data    xfs    defaults,_netdev    0 0
```

#### –®–∞–≥ 2.4: –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∏–∑ fstab:

```bash
mount -av
```

![–†–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](../images/lvm-mount.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `/opt/data : successfully mounted`

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
lsblk
df -h
```

![–ü—Ä–æ–≤–µ—Ä–∫–∞ lsblk –∏ df](../images/lvm-verify.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç lsblk:**
```
sdb           8:16   0    5G  0 disk  
‚îî‚îÄVG-DATA   253:0    0    5G  0 lvm   /opt/data
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç df:**
```
/dev/mapper/VG-DATA   5.0G   130M   4.9G   3%  /opt/data
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Physical Volumes:**
```bash
pvdisplay
pvs
```

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Volume Groups:**
```bash
vgdisplay
vgs
```

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Logical Volumes:**
```bash
lvdisplay
lvs
```

---

## üìÅ –°–≤–æ–¥–∫–∞ –∫–æ–º–∞–Ω–¥ LVM

| –û–ø–µ—Ä–∞—Ü–∏—è | –ö–æ–º–∞–Ω–¥–∞ |
| --- | --- |
| –°–æ–∑–¥–∞—Ç—å PV | `pvcreate /dev/sdX` |
| –°–æ–∑–¥–∞—Ç—å VG | `vgcreate <–∏–º—è_VG> /dev/sdX` |
| –°–æ–∑–¥–∞—Ç—å LV | `lvcreate -l 100%FREE -n <–∏–º—è_LV> <–∏–º—è_VG>` |
| –†–∞—Å—à–∏—Ä–∏—Ç—å VG | `vgextend <–∏–º—è_VG> /dev/sdY` |
| –†–∞—Å—à–∏—Ä–∏—Ç—å LV | `lvextend -l +100%FREE /dev/<VG>/<LV>` |
| –†–∞—Å—à–∏—Ä–∏—Ç—å –§–° | `xfs_growfs /opt/data` |
| –£–¥–∞–ª–∏—Ç—å LV | `lvremove /dev/<VG>/<LV>` |
| –£–¥–∞–ª–∏—Ç—å VG | `vgremove <–∏–º—è_VG>` |
| –£–¥–∞–ª–∏—Ç—å PV | `pvremove /dev/sdX` |

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
| --- | --- | --- |
| `Device not found` | iSCSI –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `iscsiadm -m session` |
| `mount: wrong fs type` | –§–° –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ | –í—ã–ø–æ–ª–Ω–∏—Ç–µ `mkfs.xfs` |
| `mount: special device does not exist` | –ù–µ–≤–µ—Ä–Ω—ã–π –ø—É—Ç—å | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `lvdisplay` |
| –¢–æ–º –Ω–µ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ | –ù–µ—Ç `_netdev` | –î–æ–±–∞–≤—å—Ç–µ –æ–ø—Ü–∏—é –≤ fstab |
| `Can't open /dev/sdb exclusively` | –î–∏—Å–∫ –∑–∞–Ω—è—Ç | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `lsof /dev/sdb` |

---

[‚Üê –ù–∞–∑–∞–¥ –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](../README.md)
