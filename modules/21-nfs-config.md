# –ú–æ–¥—É–ª—å 21. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (NFS)

[‚Üê –ù–∞–∑–∞–¥ –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](../README.md)

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

* [–û–ø–∏—Å–∞–Ω–∏–µ](#–æ–ø–∏—Å–∞–Ω–∏–µ)
* [–ß–∞—Å—Ç—å 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NFS-—Å–µ—Ä–≤–µ—Ä–∞ (srv1-cod)](#—á–∞—Å—Ç—å-1-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-nfs-—Å–µ—Ä–≤–µ—Ä–∞-srv1-cod)
* [–ß–∞—Å—Ç—å 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NFS-–∫–ª–∏–µ–Ω—Ç–∞ (admin-cod)](#—á–∞—Å—Ç—å-2-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-nfs-–∫–ª–∏–µ–Ω—Ç–∞-admin-cod)
* [–ü—Ä–æ–≤–µ—Ä–∫–∞](#–ø—Ä–æ–≤–µ—Ä–∫–∞)

---

## –û–ø–∏—Å–∞–Ω–∏–µ

–í –¥–∞–Ω–Ω–æ–º –º–æ–¥—É–ª–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Å–µ—Ç–µ–≤–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ NFS –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/opt/data` (—Å–æ–∑–¥–∞–Ω–Ω–æ–π –≤ –º–æ–¥—É–ª–µ 20 –Ω–∞ LVM-—Ç–æ–º–µ).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- |
| NFS-—Å–µ—Ä–≤–µ—Ä | srv1-cod (192.168.10.1) |
| NFS-–∫–ª–∏–µ–Ω—Ç | admin-cod (192.168.30.30) |
| –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è | /opt/data |
| –†–∞–∑—Ä–µ—à—ë–Ω–Ω–∞—è —Å–µ—Ç—å | 192.168.30.0/24 |
| –¢–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ | /mnt/nfs |

**–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:**
```
admin-cod (–ö–ª–∏–µ–Ω—Ç)                    srv1-cod (–°–µ—Ä–≤–µ—Ä)
192.168.30.30                         192.168.10.1
      ‚îÇ                                     ‚îÇ
  /mnt/nfs  ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄNFS‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  /opt/data (LVM)
```

---

## –ß–∞—Å—Ç—å 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NFS-—Å–µ—Ä–≤–µ—Ä–∞ (srv1-cod)

### srv1-cod (alt-server)

#### –®–∞–≥ 1.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤

```bash
apt-get install -y nfs-server nfs-utils
```

#### –®–∞–≥ 1.2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

–ù–∞–∑–Ω–∞—á—å—Ç–µ –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞:

```bash
chmod 777 /opt/data
```

#### –®–∞–≥ 1.3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `/etc/exports`:

```bash
nano /etc/exports
```

–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:

```
/opt/data 192.168.30.0/24(rw,no_root_squash)
```

![–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è exports](../images/nfs-exports.png)

**–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- |
| `/opt/data` | –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è |
| `192.168.30.0/24` | –†–∞–∑—Ä–µ—à—ë–Ω–Ω–∞—è —Å–µ—Ç—å (MGMT-COD) |
| `rw` | –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å |
| `no_root_squash` | root –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ = root –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ |

#### –®–∞–≥ 1.4: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∞

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É:

```bash
exportfs -arv
```

![–†–µ–∑—É–ª—å—Ç–∞—Ç exportfs](../images/nfs-exportfs.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `exporting 192.168.30.0/24:/opt/data`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã exportfs:**
| –§–ª–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- |
| `-a` | –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ |
| `-r` | –ü–µ—Ä–µ—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å (–æ–±–Ω–æ–≤–∏—Ç—å) |
| `-v` | –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ |

#### –®–∞–≥ 1.5: –ó–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã NFS

```bash
systemctl enable --now nfs-server
```

---

## –ß–∞—Å—Ç—å 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NFS-–∫–ª–∏–µ–Ω—Ç–∞ (admin-cod)

### admin-cod (alt-workstation)

#### –®–∞–≥ 2.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤

```bash
apt-get update && apt-get install -y nfs-utils nfs-clients
```

#### –®–∞–≥ 2.2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
mkdir /mnt/nfs
chmod 777 /mnt/nfs
```

#### –®–∞–≥ 2.3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `/etc/fstab`:

```bash
nano /etc/fstab
```

–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:

```
192.168.10.1:/opt/data    /mnt/nfs    nfs    defaults,_netdev    0 0
```

![–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è fstab –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ](../images/nfs-fstab-client.png)

**–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- | --- |
| –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ | 192.168.10.1:/opt/data | NFS-—Ä–µ—Å—É—Ä—Å (—Å–µ—Ä–≤–µ—Ä:–ø—É—Ç—å) |
| –¢–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è | /mnt/nfs | –õ–æ–∫–∞–ª—å–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è |
| –¢–∏–ø –§–° | nfs | –°–µ—Ç–µ–≤–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ |
| –û–ø—Ü–∏–∏ | defaults,_netdev | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ + –∂–¥–∞—Ç—å —Å–µ—Ç—å |
| dump | 0 | –ù–µ –¥–µ–ª–∞—Ç—å backup |
| pass | 0 | –ù–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å fsck |

#### –®–∞–≥ 2.4: –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
mount -av
```

![–†–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](../images/nfs-mount.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `/mnt/nfs : successfully mounted`

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (admin-cod)

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥–æ–π df

```bash
df -h
```

![–ü—Ä–æ–≤–µ—Ä–∫–∞ df](../images/nfs-df.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
192.168.10.1:/opt/data    5.0G   129M   4.9G   3%  /mnt/nfs
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `/mnt/nfs`:

![–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä](../images/nfs-file-manager.png)

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test.txt` —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º `hello`.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (srv1-cod)

```bash
ls /opt/data/
cat /opt/data/test.txt
```

![–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ](../images/nfs-verify-server.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –§–∞–π–ª `test.txt` —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º `hello` –≤–∏–¥–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

---

## üìÅ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –•–æ—Å—Ç | –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- | --- |
| srv1-cod | `/etc/exports` | –°–ø–∏—Å–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π |
| admin-cod | `/etc/fstab` | –ê–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ NFS |

---

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**NFS-—Å–µ—Ä–≤–µ—Ä:**
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ —ç–∫—Å–ø–æ—Ä—Ç—ã
exportfs -v

# –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
showmount -a

# –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
showmount -e localhost

# –ü–µ—Ä–µ—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
exportfs -arv
```

**NFS-–∫–ª–∏–µ–Ω—Ç:**
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
showmount -e 192.168.10.1

# –†—É—á–Ω–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
mount -t nfs 192.168.10.1:/opt/data /mnt/nfs

# –†–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
umount /mnt/nfs
```

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
| --- | --- | --- |
| `access denied` | –ö–ª–∏–µ–Ω—Ç –Ω–µ –≤ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–π —Å–µ—Ç–∏ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å –≤ `/etc/exports` |
| `connection refused` | NFS-—Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω | `systemctl start nfs-server` |
| `Permission denied` | –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é | `chmod 777 /opt/data` |
| `stale file handle` | –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω | –ü–µ—Ä–µ–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ä–µ—Å—É—Ä—Å |
| –ù–µ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ | –ù–µ—Ç `_netdev` | –î–æ–±–∞–≤—å—Ç–µ –æ–ø—Ü–∏—é –≤ fstab |

---

## üìä –û–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ NFS

| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- |
| `rw` | –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å |
| `ro` | –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ |
| `sync` | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ) |
| `async` | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å (–±—ã—Å—Ç—Ä–µ–µ) |
| `no_root_squash` | root –∫–ª–∏–µ–Ω—Ç–∞ = root —Å–µ—Ä–≤–µ—Ä–∞ |
| `root_squash` | root –∫–ª–∏–µ–Ω—Ç–∞ = nobody (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |
| `all_squash` | –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ = nobody |
| `no_subtree_check` | –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–¥–µ—Ä–µ–≤–∞ |

---

[‚Üê –ù–∞–∑–∞–¥ –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](../README.md)
